<!-- dashboard/templates/dashboard/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Sistema de Asistencia Automatizado</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .camera-card { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin: 10px; 
            border-radius: 5px;
        }
        .online { background-color: #d4edda; }
        .offline { background-color: #f8d7da; }
        .connected { background-color: #d1ecf1; }
        button { 
            padding: 8px 15px; 
            margin: 5px; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 3px; 
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>游꿢 Sistema de Asistencia Automatizado</h1>
    
    <div>
        <h2>Configurar C치mara</h2>
        <input type="text" id="cameraName" placeholder="Nombre del sal칩n" value="salon_101">
        <input type="text" id="cameraUrl" placeholder="URL de la c치mara" value="http://192.168.1.100/capture">
        <button onclick="addCamera()">Agregar C치mara</button>
    </div>

    <div>
        <h2>Control de Detecci칩n</h2>
        <button onclick="startAllCameras()">Iniciar Todas las C치maras</button>
        <button onclick="stopAllCameras()">Detener Todas</button>
    </div>
    
    <div id="cameras-container">
        <h2>Estado de las C치maras</h2>
        <!-- Las c치maras se cargan aqu칤 din치micamente -->
    </div>
    
    <script>
        // Funci칩n para agregar c치mara
        async function addCamera() {
            const name = document.getElementById('cameraName').value;
            const url = document.getElementById('cameraUrl').value;
            
            const response = await fetch('/detection/add_camera/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({name: name, url: url})
            });
            
            const result = await response.json();
            alert(result.status === 'added' ? 'C치mara agregada!' : 'Error: ' + result.error);
            loadCameras();
        }

        // Funci칩n para cargar estado de c치maras
        async function loadCameras() {
            try {
                const response = await fetch('/detection/attendance/');
                const data = await response.json();
                
                const container = document.getElementById('cameras-container');
                container.innerHTML = '<h2>Estado de las C치maras</h2>';
                
                for (const [cameraName, cameraData] of Object.entries(data)) {
                    const card = document.createElement('div');
                    card.className = `camera-card ${cameraData.status}`;
                    card.innerHTML = `
                        <h3>${cameraName}</h3>
                        <p>游논 Personas detectadas: <strong>${cameraData.person_count}</strong></p>
                        <p>游늵 Estado: ${cameraData.status}</p>
                        <p>游 칔ltima actualizaci칩n: ${new Date(cameraData.last_update).toLocaleString()}</p>
                        <button onclick="startCamera('${cameraName}')">Iniciar Detecci칩n</button>
                    `;
                    container.appendChild(card);
                }
            } catch (error) {
                console.error('Error cargando c치maras:', error);
            }
        }

        // Funci칩n para iniciar c치mara espec칤fica
        async function startCamera(cameraName) {
            await fetch('/detection/start/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({camera_name: cameraName})
            });
            loadCameras();
        }

        // Funci칩n para iniciar todas las c치maras
        async function startAllCameras() {
            await fetch('/detection/start/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({camera_name: 'all'})
            });
            loadCameras();
        }

        // Funci칩n para detener todas las c치maras
        async function stopAllCameras() {
            // Necesitar칤amos implementar un endpoint stop/
            alert('Funci칩n de detener pendiente de implementar');
        }

        // Actualizar cada 3 segundos
        setInterval(loadCameras, 3000);
        
        // Cargar al iniciar
        loadCameras();
    </script>
</body>
</html>